<div id="content">
    <div id="section">
        <h1>Messages</h1>
        <div id="inbox">
            <p>
                <table width="100%">
                    <% @inbox.each do |message| %>
                        <tr class="row">
                            <!-- # Sucht nach der ID ! -->
                            <td width="30%">Von: <%= User.find(message.from) %></td>
                            <td>Betreff: <%= message.subject %></td>
                            <td width="20px"><%= link_to image_tag('icons/down.png'), '#message_' + message.id.to_s, onclick: 'Application.showContent(this, ' + message.id.to_s + ')' %></td>
                        </tr>
                        <tr>
                            <td id="message_<%= message.id %>" style="display:none" colspan="2">
                                <%= message.content %><br /><br /><br />
                                <!-- Ãœbergibt from_id an das neue To Feld -->
                                <%= link_to "Antworten", new_message_path(:to => message.from) %><br /><br />
                            </td>
                        </tr>
                    <% end %>
                </table>
            </p>
        </div>

        <div id="outbox">
            <p>
                <table width="100%">
                    <% @outbox.each do |message| %>
                        <tr>
                            <!-- # Sucht nach der ID ! -->
                            <td>An:
                                <% to = ""
                                    @outbox.each do |out|
                                        UserMessage.where(message_id: out.id).each do |u|
                                            to += User.find(u.user_id).username + ", "
                                        end
                                    end
                                    to = to[0..-2]
                                %>
                                <%= to[0..-2] %>
                            </td>
                            <td>Betreff: <%= message.subject %></td>
                            <td width="20px"><%= link_to image_tag('icons/down.png'), '#message_' + message.id.to_s, onclick: 'Application.showContent(this, ' + message.id.to_s + ')' %></td>
                        </tr>
                        <tr>
                            <td id="message_<%= message.id %>" style="display:none" colspan="2"><%= message.content %></td>
                        </tr>
                        <tr>
                            <% @outbox.each do |msg| %>
                                <%= User.find(Message.find(msg.id).to).username %>
                            <% end %>
                        </tr>
                    <% end %>
                </table>
            </p>
        </div>
    </div>

    <div id="menue">
        <%= render 'shared/nav' %>

        <ul>
            <% if user_signed_in? %>
                <li><%= link_to 'New Message', new_message_path %></li>
            <% end %>
            <li><%= link_to 'Back', welcome_index_path %></li>
        </ul>
    </div>
</div>